{"ast":null,"code":"var _s = $RefreshSig$();\n// src/pages/BookingPage.jsx\nimport React, { useEffect, useState, useRef } from \"react\";\nimport io from \"socket.io-client\";\nimport axios from \"axios\";\nimport { Spinner, Container, Button, Alert, Image } from \"react-bootstrap\";\nconst BACKEND = \"http://localhost:5000\";\nconst socket = io(BACKEND, {\n  autoConnect: true\n});\nfunction BookingPage({\n  requestId: propRequestId\n}) {\n  _s();\n  const [status, setStatus] = useState(\"PENDING\");\n  const [otp, setOtp] = useState(\"\");\n  const [supplier, setSupplier] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [message, setMessage] = useState(\"\");\n  const [paymentMode, setPaymentMode] = useState(null);\n  const [paymentDone, setPaymentDone] = useState(false);\n  const [chargedUnits, setChargedUnits] = useState(0);\n  const mounted = useRef(false);\n  const fetchRequest = async id => {\n    try {\n      const token = localStorage.getItem(\"token\");\n      const res = await axios.get(`${BACKEND}/api/request/status/${id}`, {\n        headers: token ? {\n          Authorization: `Bearer ${token}`\n        } : {}\n      });\n      const req = res.data.request;\n      if (!req) return;\n      setLoading(false);\n      setStatus(req.status);\n      if (req.status === \"ACCEPTED\") {\n        setOtp(req.otp || \"\");\n        setSupplier(req.supplier || null);\n        setChargedUnits(req.unitsRequested || 0);\n      }\n    } catch (err) {\n      console.error(\"Error fetching request status:\", err);\n      setLoading(false);\n    }\n  };\n  useEffect(() => {\n    mounted.current = true;\n    const requestId = propRequestId || localStorage.getItem(\"requestId\");\n    const customerId = localStorage.getItem(\"userId\");\n    if (requestId) {\n      fetchRequest(requestId);\n\n      // Join a room named for this requestId\n      socket.emit(\"joinRoom\", {\n        room: requestId\n      });\n      console.log(\"ðŸ“¡ Customer joined room:\", requestId);\n    }\n\n    // Socket listeners\n    socket.on(\"requestAccepted\", data => {\n      console.log(\"ðŸ“© requestAccepted:\", data);\n      if (!mounted.current) return;\n      setStatus(\"ACCEPTED\");\n      setMessage(\"Your request has been accepted by the supplier!\");\n      if (data.otp) setOtp(data.otp);\n      if (data.supplier) setSupplier(data.supplier);\n    });\n    socket.on(\"requestRejected\", () => {\n      if (!mounted.current) return;\n      setStatus(\"REJECTED\");\n      setMessage(\"Your request was rejected by the supplier.\");\n    });\n\n    // other listeners ...\n\n    return () => {\n      mounted.current = false;\n      socket.off(\"requestAccepted\");\n      socket.off(\"requestRejected\");\n      // unregister others as well\n    };\n  }, [propRequestId]);\n\n  // ... rest of your code â€¦\n\n  const handlePaymentChoice = mode => {\n    setPaymentMode(mode);\n    if (mode === \"CASH\") {\n      socket.emit(\"cashPaymentChosen\", {\n        requestId: propRequestId,\n        message: \"Customer chose cash payment.\"\n      });\n    } else {\n      socket.emit(\"upiPaymentDone\", {\n        requestId: propRequestId,\n        message: \"Customer has completed UPI payment!\"\n      });\n    }\n  };\n\n  // ... rest of your component render ...\n}\n_s(BookingPage, \"m+zMKcQQDckuyAr40OcrCxvMct4=\");\n_c = BookingPage;\nexport default BookingPage;\nvar _c;\n$RefreshReg$(_c, \"BookingPage\");","map":{"version":3,"names":["React","useEffect","useState","useRef","io","axios","Spinner","Container","Button","Alert","Image","BACKEND","socket","autoConnect","BookingPage","requestId","propRequestId","_s","status","setStatus","otp","setOtp","supplier","setSupplier","loading","setLoading","message","setMessage","paymentMode","setPaymentMode","paymentDone","setPaymentDone","chargedUnits","setChargedUnits","mounted","fetchRequest","id","token","localStorage","getItem","res","get","headers","Authorization","req","data","request","unitsRequested","err","console","error","current","customerId","emit","room","log","on","off","handlePaymentChoice","mode","_c","$RefreshReg$"],"sources":["C:/Users/LENOVO/Downloads/CoolGrid-app/frontend/src/pages/BookingPage.jsx"],"sourcesContent":["// src/pages/BookingPage.jsx\r\nimport React, { useEffect, useState, useRef } from \"react\";\r\nimport io from \"socket.io-client\";\r\nimport axios from \"axios\";\r\nimport { Spinner, Container, Button, Alert, Image } from \"react-bootstrap\";\r\n\r\nconst BACKEND = \"http://localhost:5000\";\r\nconst socket = io(BACKEND, { autoConnect: true });\r\n\r\nfunction BookingPage({ requestId: propRequestId }) {\r\n  const [status, setStatus] = useState(\"PENDING\");\r\n  const [otp, setOtp] = useState(\"\");\r\n  const [supplier, setSupplier] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [message, setMessage] = useState(\"\");\r\n  const [paymentMode, setPaymentMode] = useState(null);\r\n  const [paymentDone, setPaymentDone] = useState(false);\r\n  const [chargedUnits, setChargedUnits] = useState(0);\r\n\r\n  const mounted = useRef(false);\r\n\r\n  const fetchRequest = async (id) => {\r\n    try {\r\n      const token = localStorage.getItem(\"token\");\r\n      const res = await axios.get(`${BACKEND}/api/request/status/${id}`, {\r\n        headers: token ? { Authorization: `Bearer ${token}` } : {},\r\n      });\r\n      const req = res.data.request;\r\n      if (!req) return;\r\n\r\n      setLoading(false);\r\n      setStatus(req.status);\r\n      if (req.status === \"ACCEPTED\") {\r\n        setOtp(req.otp || \"\");\r\n        setSupplier(req.supplier || null);\r\n        setChargedUnits(req.unitsRequested || 0);\r\n      }\r\n    } catch (err) {\r\n      console.error(\"Error fetching request status:\", err);\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    mounted.current = true;\r\n\r\n    const requestId = propRequestId || localStorage.getItem(\"requestId\");\r\n    const customerId = localStorage.getItem(\"userId\");\r\n\r\n    if (requestId) {\r\n      fetchRequest(requestId);\r\n\r\n      // Join a room named for this requestId\r\n      socket.emit(\"joinRoom\", { room: requestId });\r\n      console.log(\"ðŸ“¡ Customer joined room:\", requestId);\r\n    }\r\n\r\n    // Socket listeners\r\n    socket.on(\"requestAccepted\", (data) => {\r\n      console.log(\"ðŸ“© requestAccepted:\", data);\r\n      if (!mounted.current) return;\r\n      setStatus(\"ACCEPTED\");\r\n      setMessage(\"Your request has been accepted by the supplier!\");\r\n      if (data.otp) setOtp(data.otp);\r\n      if (data.supplier) setSupplier(data.supplier);\r\n    });\r\n\r\n    socket.on(\"requestRejected\", () => {\r\n      if (!mounted.current) return;\r\n      setStatus(\"REJECTED\");\r\n      setMessage(\"Your request was rejected by the supplier.\");\r\n    });\r\n\r\n    // other listeners ...\r\n\r\n    return () => {\r\n      mounted.current = false;\r\n      socket.off(\"requestAccepted\");\r\n      socket.off(\"requestRejected\");\r\n      // unregister others as well\r\n    };\r\n  }, [propRequestId]);\r\n\r\n  // ... rest of your code â€¦\r\n\r\n  const handlePaymentChoice = (mode) => {\r\n    setPaymentMode(mode);\r\n    if (mode === \"CASH\") {\r\n      socket.emit(\"cashPaymentChosen\", { \r\n        requestId: propRequestId, \r\n        message: \"Customer chose cash payment.\" \r\n      });\r\n    } else {\r\n      socket.emit(\"upiPaymentDone\", {\r\n        requestId: propRequestId, \r\n        message: \"Customer has completed UPI payment!\"\r\n      });\r\n    }\r\n  };\r\n\r\n  // ... rest of your component render ...\r\n}\r\n\r\nexport default BookingPage;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}