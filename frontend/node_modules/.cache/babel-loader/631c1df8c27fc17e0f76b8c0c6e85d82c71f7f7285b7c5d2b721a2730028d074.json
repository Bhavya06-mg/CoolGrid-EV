{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\LENOVO\\\\Downloads\\\\CoolGrid-app\\\\frontend\\\\src\\\\pages\\\\SupplierRequestDetails.jsx\",\n  _s = $RefreshSig$();\n// src/pages/SupplierRequestDetails.jsx\nimport React, { useEffect, useState } from \"react\";\nimport { useParams } from \"react-router-dom\";\nimport axios from \"axios\";\nimport { Container, Card, Button, Form, Alert, Spinner } from \"react-bootstrap\";\nimport io from \"socket.io-client\";\nimport { motion } from \"framer-motion\";\nimport { useNavigate } from \"react-router-dom\";\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst BACKEND = \"http://localhost:5000\";\nconst socket = io(BACKEND, {\n  autoConnect: true\n});\nconst navigate = useNavigate();\nexport default function SupplierRequestDetails() {\n  _s();\n  var _request$customer;\n  const {\n    requestId\n  } = useParams();\n  const [request, setRequest] = useState(null);\n  const [loading, setLoading] = useState(true);\n\n  // OTP\n  const [enteredOtp, setEnteredOtp] = useState(\"\");\n  const [verificationMsg, setVerificationMsg] = useState(\"\");\n\n  // charging states\n  const [chargingStarted, setChargingStarted] = useState(false);\n  const [chargingCompleted, setChargingCompleted] = useState(false);\n  // PAYMENT STATES\n  const [chargedUnits, setChargedUnits] = useState(0);\n  const [totalCost, setTotalCost] = useState(0);\n  const [showPaymentSection, setShowPaymentSection] = useState(false);\n\n  // NAVIGATION\n  const navigate = useNavigate();\n\n  // payment states\n  // paymentMode is derived from socket events OR backend request.payment.mode\n  const [paymentMode, setPaymentMode] = useState(null); // \"CASH\" | \"UPI\" | null\n  const [paymentConfirmed, setPaymentConfirmed] = useState(false); // final supplier confirmation\n  const [confirmLoading, setConfirmLoading] = useState(false);\n  const [message, setMessage] = useState(\"\");\n\n  // Fetch request and initialize UI from backend\n  useEffect(() => {\n    let mounted = true;\n    const fetchRequest = async () => {\n      try {\n        var _req$payment;\n        setLoading(true);\n        const res = await axios.get(`${BACKEND}/api/request/status/${requestId}`, {\n          headers: {\n            Authorization: `Bearer ${localStorage.getItem(\"token\")}`\n          }\n        });\n        if (!mounted) return;\n        const req = res.data.request;\n        setRequest(req);\n\n        // sync charging state from backend\n        if ((req === null || req === void 0 ? void 0 : req.status) === \"CHARGING\") {\n          setChargingStarted(true);\n          setChargingCompleted(false);\n        } else if ((req === null || req === void 0 ? void 0 : req.status) === \"COMPLETED\") {\n          setChargingStarted(true);\n          setChargingCompleted(true);\n        }\n\n        // sync payment mode from backend (if already chosen/recorded)\n        if (req !== null && req !== void 0 && (_req$payment = req.payment) !== null && _req$payment !== void 0 && _req$payment.mode) {\n          setPaymentMode(req.payment.mode === \"CASH\" ? \"CASH\" : req.payment.mode);\n        }\n\n        // if already marked PAID on backend\n        if ((req === null || req === void 0 ? void 0 : req.status) === \"PAID\" || req !== null && req !== void 0 && req.payment) {\n          setPaymentConfirmed(true);\n        }\n      } catch (err) {\n        console.error(\"‚ùå Error fetching request details:\", err);\n      } finally {\n        if (mounted) setLoading(false);\n      }\n    };\n    fetchRequest();\n\n    // join the room for this request so supplier receives events relevant to this booking\n    socket.emit(\"joinRoom\", {\n      room: requestId\n    });\n    console.log(\"üì° Supplier joined room:\", requestId);\n\n    // socket listeners\n    socket.on(\"cashPaymentChosen\", data => {\n      if (data.requestId === requestId) {\n        console.log(\"üíµ Customer selected Cash:\", data);\n        setPaymentMode(\"CASH\");\n        setMessage(\"Customer has chosen Cash on Delivery. Collect payment.\");\n      }\n    });\n    socket.on(\"upiPaymentDone\", data => {\n      if (data.requestId === requestId) {\n        console.log(\"üí≥ UPI Payment Done:\", data);\n        setPaymentMode(\"UPI\");\n        setMessage(\"Customer completed UPI payment.\");\n      }\n    });\n\n    // customer may emit when they themselves confirm payment (if that flow exists)\n    socket.on(\"paymentConfirmedByCustomer\", data => {\n      if (data.requestId === requestId) {\n        console.log(\"üü¢ Payment Confirmed By Customer:\", data);\n        setPaymentConfirmed(true);\n        setMessage(\"Payment confirmed by customer.\");\n      }\n    });\n\n    // optional: keep listening for chargingStarted/completed events (if other actors emit them)\n    socket.on(\"chargingStarted\", data => {\n      if (data.requestId === requestId) {\n        setChargingStarted(true);\n        setChargingCompleted(false);\n        setMessage(\"‚ö° Charging started.\");\n      }\n    });\n    socket.on(\"chargingCompleted\", data => {\n      if (data.requestId === requestId) {\n        setChargingStarted(true);\n        setChargingCompleted(true);\n        setMessage(\"‚úÖ Charging completed.\");\n\n        // üëâ Set charged units and total cost coming from backend\n        if (data.chargedUnits) setChargedUnits(data.chargedUnits);\n        if (data.totalCost) setTotalCost(data.totalCost);\n\n        // üëâ Update supplier details if present\n        if (data.supplier) {\n          setRequest(prev => ({\n            ...prev,\n            supplier: data.supplier\n          }));\n        }\n\n        // üëâ Show the Payment Confirmation Button Section\n        setShowPaymentSection(true);\n      }\n    });\n    return () => {\n      mounted = false;\n      socket.off(\"cashPaymentChosen\");\n      socket.off(\"upiPaymentDone\");\n      socket.off(\"paymentConfirmedByCustomer\");\n      socket.off(\"chargingStarted\");\n      socket.off(\"chargingCompleted\");\n    };\n  }, [requestId]);\n\n  // Verify OTP handler\n  const handleVerifyOtp = async () => {\n    try {\n      if (!enteredOtp) {\n        alert(\"Please enter OTP\");\n        return;\n      }\n      // backend expects { enteredOtp } per your controller\n      const res = await axios.post(`${BACKEND}/api/request/verify-otp/${requestId}`, {\n        enteredOtp\n      }, {\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem(\"token\")}`\n        }\n      });\n      setVerificationMsg(\"OTP Verified Successfully!\");\n      setMessage(\"‚úÖ OTP Verified ‚Äî you can start charging.\");\n      // update local request status\n      setRequest(prev => prev ? {\n        ...prev,\n        status: \"VERIFIED\"\n      } : prev);\n    } catch (err) {\n      var _err$response, _err$response2, _err$response2$data;\n      console.error(\"OTP verify error:\", ((_err$response = err.response) === null || _err$response === void 0 ? void 0 : _err$response.data) || err);\n      setVerificationMsg(((_err$response2 = err.response) === null || _err$response2 === void 0 ? void 0 : (_err$response2$data = _err$response2.data) === null || _err$response2$data === void 0 ? void 0 : _err$response2$data.message) || \"Invalid OTP\");\n    }\n  };\n\n  // Start charging\n  const handleStartCharging = async () => {\n    try {\n      setChargingStarted(true); // optimistic update\n      const res = await axios.post(`${BACKEND}/api/request/start-charging/${requestId}`, {}, {\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem(\"token\")}`\n        }\n      });\n      console.log(\"Start charging response:\", res.data);\n      setMessage(\"‚ö° Charging started.\");\n      setRequest(prev => prev ? {\n        ...prev,\n        status: \"CHARGING\"\n      } : prev);\n    } catch (err) {\n      console.error(\"Error starting charging:\", err);\n      // revert optimistic\n      setChargingStarted(false);\n      alert(\"Failed to start charging. See console for details.\");\n    }\n  };\n\n  // Complete charging\n  const handleCompleteCharging = async () => {\n    try {\n      const res = await axios.post(`${BACKEND}/api/request/complete-charging/${requestId}`, {}, {\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem(\"token\")}`\n        }\n      });\n      console.log(\"Complete charging response:\", res.data);\n      setChargingCompleted(true);\n      setMessage(\"‚úÖ Charging completed. Awaiting payment.\");\n      setRequest(prev => prev ? {\n        ...prev,\n        status: \"COMPLETED\"\n      } : prev);\n\n      // forward supplier -> customer notification is handled by backend (controller emits chargingCompleted)\n    } catch (err) {\n      console.error(\"Error completing charging:\", err);\n      alert(\"Failed to complete charging. See console for details.\");\n    }\n  };\n\n  // Supplier confirms COD payment: call backend markPaid and emit to customer\n  const handleSupplierConfirmPayment = async () => {\n    try {\n      setConfirmLoading(true);\n      const res = await axios.post(`http://localhost:5000/api/request/payment/${requestId}`, {\n        mode: \"CASH\",\n        amountPaid: totalCost,\n        transactionId: \"COD-\" + Date.now()\n      });\n\n      // emit to customer\n      socket.emit(\"paymentConfirmedBySupplier\", {\n        customerId: request.customer._id,\n        supplierId: request.supplier._id,\n        requestId,\n        message: \"Payment Completed!\"\n      });\n\n      // update UI\n      setPaymentConfirmed(true);\n\n      // redirect supplier\n      navigate(\"/supplier/dashboard\");\n    } catch (err) {\n      console.error(\"Error confirming payment:\", err);\n    } finally {\n      setConfirmLoading(false);\n    }\n  };\n  if (loading) {\n    return /*#__PURE__*/_jsxDEV(Container, {\n      className: \"text-center mt-5\",\n      children: [/*#__PURE__*/_jsxDEV(Spinner, {\n        animation: \"border\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 260,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"Loading request details...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 261,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 259,\n      columnNumber: 7\n    }, this);\n  }\n  if (!request) {\n    return /*#__PURE__*/_jsxDEV(Container, {\n      className: \"mt-5 text-center\",\n      children: /*#__PURE__*/_jsxDEV(Alert, {\n        variant: \"danger\",\n        children: \"Request not found.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 269,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 268,\n      columnNumber: 7\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(Container, {\n    className: \"mt-5\",\n    children: /*#__PURE__*/_jsxDEV(Card, {\n      className: \"p-4 shadow\",\n      children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n        children: \"\\uD83D\\uDD0C Request Details\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 277,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: [/*#__PURE__*/_jsxDEV(\"b\", {\n          children: \"Customer:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 280,\n          columnNumber: 11\n        }, this), \" \", request.customerName || ((_request$customer = request.customer) === null || _request$customer === void 0 ? void 0 : _request$customer.name)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 279,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: [/*#__PURE__*/_jsxDEV(\"b\", {\n          children: \"Units Needed:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 283,\n          columnNumber: 11\n        }, this), \" \", request.unitsRequested]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 282,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: [/*#__PURE__*/_jsxDEV(\"b\", {\n          children: \"Status:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 286,\n          columnNumber: 11\n        }, this), \" \", request.status]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 285,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"hr\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 289,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"h4\", {\n        children: \"\\uD83D\\uDD10 OTP Verification\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 291,\n        columnNumber: 9\n      }, this), verificationMsg && /*#__PURE__*/_jsxDEV(Alert, {\n        variant: \"info\",\n        children: verificationMsg\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 293,\n        columnNumber: 29\n      }, this), request.status !== \"COMPLETED\" && !paymentMode && /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(Form.Group, {\n          children: [/*#__PURE__*/_jsxDEV(Form.Label, {\n            children: \"Enter OTP sent to customer\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 298,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(Form.Control, {\n            type: \"text\",\n            placeholder: \"Enter OTP\",\n            value: enteredOtp,\n            onChange: e => setEnteredOtp(e.target.value)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 299,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 297,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          className: \"mt-3\",\n          variant: \"primary\",\n          onClick: handleVerifyOtp,\n          children: \"Verify OTP\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 307,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true), /*#__PURE__*/_jsxDEV(\"hr\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 313,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"p-4\",\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"Charging Controls\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 317,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(motion.div, {\n          whileTap: {\n            scale: 0.95\n          },\n          initial: {\n            opacity: 0,\n            y: 20\n          },\n          animate: {\n            opacity: 1,\n            y: 0\n          },\n          transition: {\n            duration: 0.3\n          },\n          className: \"mb-3\",\n          children: /*#__PURE__*/_jsxDEV(Button, {\n            variant: \"success\",\n            onClick: handleStartCharging,\n            disabled: chargingStarted,\n            style: {\n              width: \"200px\"\n            },\n            children: chargingStarted ? \"Charging Started ‚úî\" : \"Start Charging\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 326,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 319,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(motion.div, {\n          whileTap: {\n            scale: 0.95\n          },\n          initial: {\n            opacity: 0,\n            y: 20\n          },\n          animate: {\n            opacity: 1,\n            y: 0\n          },\n          transition: {\n            duration: 0.3,\n            delay: 0.2\n          },\n          children: /*#__PURE__*/_jsxDEV(Button, {\n            variant: \"primary\",\n            onClick: handleCompleteCharging,\n            disabled: !chargingStarted || chargingCompleted,\n            style: {\n              width: \"200px\"\n            },\n            children: chargingCompleted ? \"Charging Completed ‚úî\" : \"Complete Charging\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 342,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 336,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"mt-4\",\n          children: chargingCompleted ? /*#__PURE__*/_jsxDEV(Alert, {\n            variant: \"success\",\n            children: \"Charging fully completed!\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 354,\n            columnNumber: 15\n          }, this) : chargingStarted ? /*#__PURE__*/_jsxDEV(Alert, {\n            variant: \"info\",\n            children: \"Charging in progress...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 356,\n            columnNumber: 15\n          }, this) : /*#__PURE__*/_jsxDEV(Alert, {\n            variant: \"warning\",\n            children: \"Waiting to start charging...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 358,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 352,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 316,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"hr\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 363,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"h4\", {\n        children: \"\\uD83D\\uDCB3 Payment\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 370,\n        columnNumber: 1\n      }, this), paymentMode === \"CASH\" && chargingCompleted && !paymentConfirmed && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"p-4\",\n        children: /*#__PURE__*/_jsxDEV(motion.div, {\n          whileTap: {\n            scale: 0.95\n          },\n          initial: {\n            opacity: 0,\n            y: 20\n          },\n          animate: {\n            opacity: 1,\n            y: 0\n          },\n          transition: {\n            duration: 0.3\n          },\n          children: /*#__PURE__*/_jsxDEV(Button, {\n            variant: \"success\",\n            onClick: handleSupplierConfirmPayment,\n            disabled: confirmLoading,\n            style: {\n              width: \"220px\"\n            },\n            children: confirmLoading ? \"Confirming...\" : \"Confirm Payment (COD)\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 381,\n            columnNumber: 7\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 375,\n          columnNumber: 5\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 374,\n        columnNumber: 3\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 276,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 275,\n    columnNumber: 5\n  }, this);\n}\n_s(SupplierRequestDetails, \"nJtPxgZadu/dqnwAxtu7pwbMZFc=\", false, function () {\n  return [useParams, useNavigate];\n});\n_c = SupplierRequestDetails;\nvar _c;\n$RefreshReg$(_c, \"SupplierRequestDetails\");","map":{"version":3,"names":["React","useEffect","useState","useParams","axios","Container","Card","Button","Form","Alert","Spinner","io","motion","useNavigate","jsxDEV","_jsxDEV","Fragment","_Fragment","BACKEND","socket","autoConnect","navigate","SupplierRequestDetails","_s","_request$customer","requestId","request","setRequest","loading","setLoading","enteredOtp","setEnteredOtp","verificationMsg","setVerificationMsg","chargingStarted","setChargingStarted","chargingCompleted","setChargingCompleted","chargedUnits","setChargedUnits","totalCost","setTotalCost","showPaymentSection","setShowPaymentSection","paymentMode","setPaymentMode","paymentConfirmed","setPaymentConfirmed","confirmLoading","setConfirmLoading","message","setMessage","mounted","fetchRequest","_req$payment","res","get","headers","Authorization","localStorage","getItem","req","data","status","payment","mode","err","console","error","emit","room","log","on","supplier","prev","off","handleVerifyOtp","alert","post","_err$response","_err$response2","_err$response2$data","response","handleStartCharging","handleCompleteCharging","handleSupplierConfirmPayment","amountPaid","transactionId","Date","now","customerId","customer","_id","supplierId","className","children","animation","fileName","_jsxFileName","lineNumber","columnNumber","variant","customerName","name","unitsRequested","Group","Label","Control","type","placeholder","value","onChange","e","target","onClick","div","whileTap","scale","initial","opacity","y","animate","transition","duration","disabled","style","width","delay","_c","$RefreshReg$"],"sources":["C:/Users/LENOVO/Downloads/CoolGrid-app/frontend/src/pages/SupplierRequestDetails.jsx"],"sourcesContent":["// src/pages/SupplierRequestDetails.jsx\r\nimport React, { useEffect, useState } from \"react\";\r\nimport { useParams } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\nimport { Container, Card, Button, Form, Alert, Spinner } from \"react-bootstrap\";\r\nimport io from \"socket.io-client\";\r\nimport { motion } from \"framer-motion\";\r\nimport { useNavigate } from \"react-router-dom\";\r\n\r\n\r\nconst BACKEND = \"http://localhost:5000\";\r\nconst socket = io(BACKEND, { autoConnect: true });\r\nconst navigate = useNavigate();\r\n\r\n\r\nexport default function SupplierRequestDetails() {\r\n  const { requestId } = useParams();\r\n\r\n  const [request, setRequest] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  // OTP\r\n  const [enteredOtp, setEnteredOtp] = useState(\"\");\r\n  const [verificationMsg, setVerificationMsg] = useState(\"\");\r\n\r\n  // charging states\r\n  const [chargingStarted, setChargingStarted] = useState(false);\r\n  const [chargingCompleted, setChargingCompleted] = useState(false);\r\n  // PAYMENT STATES\r\nconst [chargedUnits, setChargedUnits] = useState(0);\r\nconst [totalCost, setTotalCost] = useState(0);\r\nconst [showPaymentSection, setShowPaymentSection] = useState(false);\r\n\r\n// NAVIGATION\r\nconst navigate = useNavigate();\r\n\r\n  // payment states\r\n  // paymentMode is derived from socket events OR backend request.payment.mode\r\n  const [paymentMode, setPaymentMode] = useState(null); // \"CASH\" | \"UPI\" | null\r\n  const [paymentConfirmed, setPaymentConfirmed] = useState(false); // final supplier confirmation\r\n  const [confirmLoading, setConfirmLoading] = useState(false);\r\n\r\n  const [message, setMessage] = useState(\"\");\r\n\r\n  // Fetch request and initialize UI from backend\r\n  useEffect(() => {\r\n    let mounted = true;\r\n\r\n    const fetchRequest = async () => {\r\n      try {\r\n        setLoading(true);\r\n        const res = await axios.get(`${BACKEND}/api/request/status/${requestId}`, {\r\n          headers: { Authorization: `Bearer ${localStorage.getItem(\"token\")}` },\r\n        });\r\n\r\n        if (!mounted) return;\r\n        const req = res.data.request;\r\n        setRequest(req);\r\n\r\n        // sync charging state from backend\r\n        if (req?.status === \"CHARGING\") {\r\n          setChargingStarted(true);\r\n          setChargingCompleted(false);\r\n        } else if (req?.status === \"COMPLETED\") {\r\n          setChargingStarted(true);\r\n          setChargingCompleted(true);\r\n        }\r\n\r\n        // sync payment mode from backend (if already chosen/recorded)\r\n        if (req?.payment?.mode) {\r\n          setPaymentMode(req.payment.mode === \"CASH\" ? \"CASH\" : req.payment.mode);\r\n        }\r\n\r\n        // if already marked PAID on backend\r\n        if (req?.status === \"PAID\" || req?.payment) {\r\n          setPaymentConfirmed(true);\r\n        }\r\n      } catch (err) {\r\n        console.error(\"‚ùå Error fetching request details:\", err);\r\n      } finally {\r\n        if (mounted) setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchRequest();\r\n\r\n    // join the room for this request so supplier receives events relevant to this booking\r\n    socket.emit(\"joinRoom\", { room: requestId });\r\n    console.log(\"üì° Supplier joined room:\", requestId);\r\n\r\n    // socket listeners\r\n    socket.on(\"cashPaymentChosen\", (data) => {\r\n      if (data.requestId === requestId) {\r\n        console.log(\"üíµ Customer selected Cash:\", data);\r\n        setPaymentMode(\"CASH\");\r\n        setMessage(\"Customer has chosen Cash on Delivery. Collect payment.\");\r\n      }\r\n    });\r\n\r\n    socket.on(\"upiPaymentDone\", (data) => {\r\n      if (data.requestId === requestId) {\r\n        console.log(\"üí≥ UPI Payment Done:\", data);\r\n        setPaymentMode(\"UPI\");\r\n        setMessage(\"Customer completed UPI payment.\");\r\n      }\r\n    });\r\n\r\n    // customer may emit when they themselves confirm payment (if that flow exists)\r\n    socket.on(\"paymentConfirmedByCustomer\", (data) => {\r\n      if (data.requestId === requestId) {\r\n        console.log(\"üü¢ Payment Confirmed By Customer:\", data);\r\n        setPaymentConfirmed(true);\r\n        setMessage(\"Payment confirmed by customer.\");\r\n      }\r\n    });\r\n\r\n    // optional: keep listening for chargingStarted/completed events (if other actors emit them)\r\n    socket.on(\"chargingStarted\", (data) => {\r\n      if (data.requestId === requestId) {\r\n        setChargingStarted(true);\r\n        setChargingCompleted(false);\r\n        setMessage(\"‚ö° Charging started.\");\r\n      }\r\n    });\r\n\r\n   socket.on(\"chargingCompleted\", (data) => {\r\n  if (data.requestId === requestId) {\r\n    setChargingStarted(true);\r\n    setChargingCompleted(true);\r\n    setMessage(\"‚úÖ Charging completed.\");\r\n\r\n    // üëâ Set charged units and total cost coming from backend\r\n    if (data.chargedUnits) setChargedUnits(data.chargedUnits);\r\n    if (data.totalCost) setTotalCost(data.totalCost);\r\n\r\n    // üëâ Update supplier details if present\r\n    if (data.supplier) {\r\n      setRequest((prev) => ({ ...prev, supplier: data.supplier }));\r\n    }\r\n\r\n    // üëâ Show the Payment Confirmation Button Section\r\n    setShowPaymentSection(true);\r\n  }\r\n});\r\n\r\n\r\n    return () => {\r\n      mounted = false;\r\n      socket.off(\"cashPaymentChosen\");\r\n      socket.off(\"upiPaymentDone\");\r\n      socket.off(\"paymentConfirmedByCustomer\");\r\n      socket.off(\"chargingStarted\");\r\n      socket.off(\"chargingCompleted\");\r\n    };\r\n  }, [requestId]);\r\n\r\n  // Verify OTP handler\r\n  const handleVerifyOtp = async () => {\r\n    try {\r\n      if (!enteredOtp) {\r\n        alert(\"Please enter OTP\");\r\n        return;\r\n      }\r\n      // backend expects { enteredOtp } per your controller\r\n      const res = await axios.post(\r\n        `${BACKEND}/api/request/verify-otp/${requestId}`,\r\n        { enteredOtp },\r\n        { headers: { Authorization: `Bearer ${localStorage.getItem(\"token\")}` } }\r\n      );\r\n\r\n      setVerificationMsg(\"OTP Verified Successfully!\");\r\n      setMessage(\"‚úÖ OTP Verified ‚Äî you can start charging.\");\r\n      // update local request status\r\n      setRequest((prev) => (prev ? { ...prev, status: \"VERIFIED\" } : prev));\r\n    } catch (err) {\r\n      console.error(\"OTP verify error:\", err.response?.data || err);\r\n      setVerificationMsg(err.response?.data?.message || \"Invalid OTP\");\r\n    }\r\n  };\r\n\r\n  // Start charging\r\n  const handleStartCharging = async () => {\r\n    try {\r\n      setChargingStarted(true); // optimistic update\r\n      const res = await axios.post(\r\n        `${BACKEND}/api/request/start-charging/${requestId}`,\r\n        {},\r\n        { headers: { Authorization: `Bearer ${localStorage.getItem(\"token\")}` } }\r\n      );\r\n      console.log(\"Start charging response:\", res.data);\r\n      setMessage(\"‚ö° Charging started.\");\r\n      setRequest((prev) => (prev ? { ...prev, status: \"CHARGING\" } : prev));\r\n    } catch (err) {\r\n      console.error(\"Error starting charging:\", err);\r\n      // revert optimistic\r\n      setChargingStarted(false);\r\n      alert(\"Failed to start charging. See console for details.\");\r\n    }\r\n  };\r\n\r\n  // Complete charging\r\n  const handleCompleteCharging = async () => {\r\n    try {\r\n      const res = await axios.post(\r\n        `${BACKEND}/api/request/complete-charging/${requestId}`,\r\n        {},\r\n        { headers: { Authorization: `Bearer ${localStorage.getItem(\"token\")}` } }\r\n      );\r\n\r\n      console.log(\"Complete charging response:\", res.data);\r\n      setChargingCompleted(true);\r\n      setMessage(\"‚úÖ Charging completed. Awaiting payment.\");\r\n      setRequest((prev) => (prev ? { ...prev, status: \"COMPLETED\" } : prev));\r\n\r\n      // forward supplier -> customer notification is handled by backend (controller emits chargingCompleted)\r\n    } catch (err) {\r\n      console.error(\"Error completing charging:\", err);\r\n      alert(\"Failed to complete charging. See console for details.\");\r\n    }\r\n  };\r\n\r\n  // Supplier confirms COD payment: call backend markPaid and emit to customer\r\n const handleSupplierConfirmPayment = async () => {\r\n  try {\r\n    setConfirmLoading(true);\r\n\r\n    const res = await axios.post(\r\n      `http://localhost:5000/api/request/payment/${requestId}`,\r\n      {\r\n        mode: \"CASH\",\r\n        amountPaid: totalCost,\r\n        transactionId: \"COD-\" + Date.now(),\r\n      }\r\n    );\r\n\r\n    // emit to customer\r\n    socket.emit(\"paymentConfirmedBySupplier\", {\r\n      customerId: request.customer._id,\r\n      supplierId: request.supplier._id,\r\n      requestId,\r\n      message: \"Payment Completed!\",\r\n    });\r\n\r\n    // update UI\r\n    setPaymentConfirmed(true);\r\n\r\n    // redirect supplier\r\n    navigate(\"/supplier/dashboard\");\r\n  } catch (err) {\r\n    console.error(\"Error confirming payment:\", err);\r\n  } finally {\r\n    setConfirmLoading(false);\r\n  }\r\n};\r\n\r\n\r\n  if (loading) {\r\n    return (\r\n      <Container className=\"text-center mt-5\">\r\n        <Spinner animation=\"border\" />\r\n        <p>Loading request details...</p>\r\n      </Container>\r\n    );\r\n  }\r\n\r\n  if (!request) {\r\n    return (\r\n      <Container className=\"mt-5 text-center\">\r\n        <Alert variant=\"danger\">Request not found.</Alert>\r\n      </Container>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <Container className=\"mt-5\">\r\n      <Card className=\"p-4 shadow\">\r\n        <h3>üîå Request Details</h3>\r\n\r\n        <p>\r\n          <b>Customer:</b> {request.customerName || request.customer?.name}\r\n        </p>\r\n        <p>\r\n          <b>Units Needed:</b> {request.unitsRequested}\r\n        </p>\r\n        <p>\r\n          <b>Status:</b> {request.status}\r\n        </p>\r\n\r\n        <hr />\r\n\r\n        <h4>üîê OTP Verification</h4>\r\n\r\n        {verificationMsg && <Alert variant=\"info\">{verificationMsg}</Alert>}\r\n\r\n        {request.status !== \"COMPLETED\" && !paymentMode && (\r\n          <>\r\n            <Form.Group>\r\n              <Form.Label>Enter OTP sent to customer</Form.Label>\r\n              <Form.Control\r\n                type=\"text\"\r\n                placeholder=\"Enter OTP\"\r\n                value={enteredOtp}\r\n                onChange={(e) => setEnteredOtp(e.target.value)}\r\n              />\r\n            </Form.Group>\r\n\r\n            <Button className=\"mt-3\" variant=\"primary\" onClick={handleVerifyOtp}>\r\n              Verify OTP\r\n            </Button>\r\n          </>\r\n        )}\r\n\r\n        <hr />\r\n\r\n        {/* Charging Controls */}\r\n        <div className=\"p-4\">\r\n          <h3>Charging Controls</h3>\r\n\r\n          <motion.div\r\n            whileTap={{ scale: 0.95 }}\r\n            initial={{ opacity: 0, y: 20 }}\r\n            animate={{ opacity: 1, y: 0 }}\r\n            transition={{ duration: 0.3 }}\r\n            className=\"mb-3\"\r\n          >\r\n            <Button\r\n              variant=\"success\"\r\n              onClick={handleStartCharging}\r\n              disabled={chargingStarted}\r\n              style={{ width: \"200px\" }}\r\n            >\r\n              {chargingStarted ? \"Charging Started ‚úî\" : \"Start Charging\"}\r\n            </Button>\r\n          </motion.div>\r\n\r\n          <motion.div\r\n            whileTap={{ scale: 0.95 }}\r\n            initial={{ opacity: 0, y: 20 }}\r\n            animate={{ opacity: 1, y: 0 }}\r\n            transition={{ duration: 0.3, delay: 0.2 }}\r\n          >\r\n            <Button\r\n              variant=\"primary\"\r\n              onClick={handleCompleteCharging}\r\n              disabled={!chargingStarted || chargingCompleted}\r\n              style={{ width: \"200px\" }}\r\n            >\r\n              {chargingCompleted ? \"Charging Completed ‚úî\" : \"Complete Charging\"}\r\n            </Button>\r\n          </motion.div>\r\n\r\n          <div className=\"mt-4\">\r\n            {chargingCompleted ? (\r\n              <Alert variant=\"success\">Charging fully completed!</Alert>\r\n            ) : chargingStarted ? (\r\n              <Alert variant=\"info\">Charging in progress...</Alert>\r\n            ) : (\r\n              <Alert variant=\"warning\">Waiting to start charging...</Alert>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        <hr />\r\n\r\n         {/* *********************************************************************\r\n              UPDATED PAYMENT SECTION (MATCHES UI STYLE OF CHARGING CONTROLS)\r\n        ********************************************************************** */}\r\n\r\n       {/* Payment Section */}\r\n<h4>üí≥ Payment</h4>\r\n\r\n{/* Show Confirm Payment button for COD when charging completed */}\r\n{paymentMode === \"CASH\" && chargingCompleted && !paymentConfirmed && (\r\n  <div className=\"p-4\">\r\n    <motion.div\r\n      whileTap={{ scale: 0.95 }}\r\n      initial={{ opacity: 0, y: 20 }}\r\n      animate={{ opacity: 1, y: 0 }}\r\n      transition={{ duration: 0.3 }}\r\n    >\r\n      <Button\r\n        variant=\"success\"\r\n        onClick={handleSupplierConfirmPayment}\r\n        disabled={confirmLoading}\r\n        style={{ width: \"220px\" }}\r\n      >\r\n        {confirmLoading ? \"Confirming...\" : \"Confirm Payment (COD)\"}\r\n      </Button>\r\n    </motion.div>\r\n  </div>\r\n)}\r\n\r\n      </Card>\r\n    </Container>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}