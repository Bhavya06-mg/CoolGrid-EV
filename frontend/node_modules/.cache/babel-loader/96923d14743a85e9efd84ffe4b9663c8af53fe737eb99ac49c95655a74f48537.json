{"ast":null,"code":"// backend/controllers/authController.js\nimport bcrypt from \"bcryptjs\";\nimport jwt from \"jsonwebtoken\";\nimport Customer from \"../models/Customer.js\";\nimport Supplier from \"../models/Supplier.js\";\n\n// Generate JWT\nconst generateToken = (id, role) => {\n  return jwt.sign({\n    id,\n    role\n  }, process.env.JWT_SECRET, {\n    expiresIn: \"30d\"\n  });\n};\n\n// Login (Customer or Supplier)\nexport const login = async (req, res) => {\n  try {\n    const {\n      username,\n      password,\n      role\n    } = req.body; // ✅ Accept role directly from frontend\n\n    let user;\n    if (role === \"CUSTOMER\") {\n      user = await Customer.findOne({\n        username\n      });\n    } else if (role === \"SUPPLIER\") {\n      user = await Supplier.findOne({\n        username\n      });\n    } else {\n      return res.status(400).json({\n        message: \"Invalid role selected\"\n      });\n    }\n    if (!user) return res.status(404).json({\n      message: `${role} not found`\n    });\n    const isMatch = await bcrypt.compare(password, user.password);\n    if (!isMatch) return res.status(400).json({\n      message: \"Invalid credentials\"\n    });\n    const token = generateToken(user._id, role);\n    res.json({\n      token,\n      role,\n      id: user._id,\n      username: user.username,\n      message: `${role} login successful`\n    });\n  } catch (err) {\n    console.error(\"❌ Login error:\", err);\n    res.status(500).json({\n      message: \"Server Error\",\n      error: err.message\n    });\n  }\n};","map":{"version":3,"names":["bcrypt","jwt","Customer","Supplier","generateToken","id","role","sign","process","env","JWT_SECRET","expiresIn","login","req","res","username","password","body","user","findOne","status","json","message","isMatch","compare","token","_id","err","console","error"],"sources":["C:/Users/LENOVO/Downloads/CoolGrid-app/frontend/src/pages/Login.jsx"],"sourcesContent":["// backend/controllers/authController.js\r\nimport bcrypt from \"bcryptjs\";\r\nimport jwt from \"jsonwebtoken\";\r\nimport Customer from \"../models/Customer.js\";\r\nimport Supplier from \"../models/Supplier.js\";\r\n\r\n// Generate JWT\r\nconst generateToken = (id, role) => {\r\n  return jwt.sign({ id, role }, process.env.JWT_SECRET, {\r\n    expiresIn: \"30d\",\r\n  });\r\n};\r\n\r\n// Login (Customer or Supplier)\r\nexport const login = async (req, res) => {\r\n  try {\r\n    const { username, password, role } = req.body; // ✅ Accept role directly from frontend\r\n\r\n    let user;\r\n    if (role === \"CUSTOMER\") {\r\n      user = await Customer.findOne({ username });\r\n    } else if (role === \"SUPPLIER\") {\r\n      user = await Supplier.findOne({ username });\r\n    } else {\r\n      return res.status(400).json({ message: \"Invalid role selected\" });\r\n    }\r\n\r\n    if (!user) return res.status(404).json({ message: `${role} not found` });\r\n\r\n    const isMatch = await bcrypt.compare(password, user.password);\r\n    if (!isMatch) return res.status(400).json({ message: \"Invalid credentials\" });\r\n\r\n    const token = generateToken(user._id, role);\r\n\r\n    res.json({\r\n      token,\r\n      role,\r\n      id: user._id,\r\n      username: user.username,\r\n      message: `${role} login successful`,\r\n    });\r\n  } catch (err) {\r\n    console.error(\"❌ Login error:\", err);\r\n    res.status(500).json({ message: \"Server Error\", error: err.message });\r\n  }\r\n};\r\n"],"mappings":"AAAA;AACA,OAAOA,MAAM,MAAM,UAAU;AAC7B,OAAOC,GAAG,MAAM,cAAc;AAC9B,OAAOC,QAAQ,MAAM,uBAAuB;AAC5C,OAAOC,QAAQ,MAAM,uBAAuB;;AAE5C;AACA,MAAMC,aAAa,GAAGA,CAACC,EAAE,EAAEC,IAAI,KAAK;EAClC,OAAOL,GAAG,CAACM,IAAI,CAAC;IAAEF,EAAE;IAAEC;EAAK,CAAC,EAAEE,OAAO,CAACC,GAAG,CAACC,UAAU,EAAE;IACpDC,SAAS,EAAE;EACb,CAAC,CAAC;AACJ,CAAC;;AAED;AACA,OAAO,MAAMC,KAAK,GAAG,MAAAA,CAAOC,GAAG,EAAEC,GAAG,KAAK;EACvC,IAAI;IACF,MAAM;MAAEC,QAAQ;MAAEC,QAAQ;MAAEV;IAAK,CAAC,GAAGO,GAAG,CAACI,IAAI,CAAC,CAAC;;IAE/C,IAAIC,IAAI;IACR,IAAIZ,IAAI,KAAK,UAAU,EAAE;MACvBY,IAAI,GAAG,MAAMhB,QAAQ,CAACiB,OAAO,CAAC;QAAEJ;MAAS,CAAC,CAAC;IAC7C,CAAC,MAAM,IAAIT,IAAI,KAAK,UAAU,EAAE;MAC9BY,IAAI,GAAG,MAAMf,QAAQ,CAACgB,OAAO,CAAC;QAAEJ;MAAS,CAAC,CAAC;IAC7C,CAAC,MAAM;MACL,OAAOD,GAAG,CAACM,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QAAEC,OAAO,EAAE;MAAwB,CAAC,CAAC;IACnE;IAEA,IAAI,CAACJ,IAAI,EAAE,OAAOJ,GAAG,CAACM,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;MAAEC,OAAO,EAAE,GAAGhB,IAAI;IAAa,CAAC,CAAC;IAExE,MAAMiB,OAAO,GAAG,MAAMvB,MAAM,CAACwB,OAAO,CAACR,QAAQ,EAAEE,IAAI,CAACF,QAAQ,CAAC;IAC7D,IAAI,CAACO,OAAO,EAAE,OAAOT,GAAG,CAACM,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;MAAEC,OAAO,EAAE;IAAsB,CAAC,CAAC;IAE7E,MAAMG,KAAK,GAAGrB,aAAa,CAACc,IAAI,CAACQ,GAAG,EAAEpB,IAAI,CAAC;IAE3CQ,GAAG,CAACO,IAAI,CAAC;MACPI,KAAK;MACLnB,IAAI;MACJD,EAAE,EAAEa,IAAI,CAACQ,GAAG;MACZX,QAAQ,EAAEG,IAAI,CAACH,QAAQ;MACvBO,OAAO,EAAE,GAAGhB,IAAI;IAClB,CAAC,CAAC;EACJ,CAAC,CAAC,OAAOqB,GAAG,EAAE;IACZC,OAAO,CAACC,KAAK,CAAC,gBAAgB,EAAEF,GAAG,CAAC;IACpCb,GAAG,CAACM,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;MAAEC,OAAO,EAAE,cAAc;MAAEO,KAAK,EAAEF,GAAG,CAACL;IAAQ,CAAC,CAAC;EACvE;AACF,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}